# 제프리 리처의 WINDOWS vai C/C++

</br>

## 문자와 문자열로 작업하기 (2023-02-11)

- 문자인코딩 
  - UTF-8 : 1,2,3,4 바이트로 인코딩 수행하며, 0x0080 미만에 있다면 1바이트, 0x07FF 이내면 2바이트, 0x0800 이상의 문자들은 3바이트로 인코딩한다.
  - UTF-32 : 모든 문자를 4byte로 인코딩 파일저장이나 네트워크 전송시에는 거의 사용되지 않는다.

- ANSI 문자와 유니코드 문자 그리고 문자열 자료형
  - ANSI 문자열 : 1바이트 문자로 구성된 문자열
  - c/c++ 컴파일러는 16비트 유니코드를 표현하기 위한 wchar_t 자료형을 내장 자료형으로 처리할 수 있는 기능 추가 
    ```C++
      wchar_t c= L'A';
    ```
  - API들을 보다보면 끝이 W,A 로 끝나는 함수가 있다. A는 ANSI W는 wideCharacter 16비트 유니코드를 문자열로 취급한다.

- _S 가 붙은 안전한 함수나 Tchar 활용
  - _s 문자열 함수는 내부적으로 가장 먼저 인자의 유효성을 검사한다. NULL, 정수값 유효범위, 열거형 값이 유효한지 
  - Tchar 유니코드,ANSI 에 맞게 연결된 함수 호출 
 
- 유니코드 장점
  - 지역화가 유리하다.
  - 단일의 바이너리 파일로 모든 언어 지원가능
  - 유니코드 사용시 윈도우가 제공하는 모든 함수를 쉽게 이용가능
  - 유니코드 사용시 .NET과 상호 운용이 쉽다.



## 커널오브젝트 (2023-02-11 ~ 2023-02-12)
  
  - Section 1 
    - 커널 오브젝트 정의 : 운영체제에서 리소스(쓰레드,프로세스,파일) 들을 관리하기 위한 데이터를 저장하는 메모리 블록 
      - 커널 오브젝트는 커널에 의해 할당된 간단한 메모리 블록
      - 커널에 의해서만 접근이 가능한 구조체로 구성 
      - 커널 오브젝트에 대한 세부 정보 저장 (보안디스크립터, 사용카운트) 공통 부분
      - 커널 오브젝트 생성시 함수는 각 커널 오브젝트를 구분 하기 위한 핸들 값을 반환
      - 핸들 값은 르로세스 내의 모든 스레드에서 사용 가능하지만 의미는 없다 (64bit , 32bit)
      - 프로세스 별로 독립된 핸들 테이블을 가지고 있다. 

    - Usage(사용카운트) 
      - 커널 오브젝트는 프로세스가 아니라 커널에 의해 소유되기 때문에 프로세스가 종료된다고해서 오브젝트가 삭제되는게 아니다.
      - 사용 카운트를 통해 얼마나 많은 프로세스가 커널 오브젝트를 사용하고 있는지 알 수 있다.
      - 최초 생성시 사용 카운트는 1로 설정 
      - 다른 프로세스가 접근 권한 획득시 사용 카운트 증가
      - 0이되면 커널오브젝트 삭제
    
    - 보안 디스크립터
      - 커널 오브젝트 소유권, 접근권한, 접근제한 여부 정보를 가지고있다.
      - 커널 오브젝트를 생성하는 거의 대부분의 함수들은 SECURITY_ATTRIBUTES 구조체에 대한 포인터를 받는다.
      - 현재 프로세스의 보안토큰을 근간하는 기본 보안디스크립터를 사용하기에 NULL 전달 무관 

  - Section 2 
    - 핸들 테이블 : 커널오브젝트에 접근하기 위한 핸들을 관리하기위한 테이블 
      - 프로세스 핸들 테이블의 구조 : 인덱스, 메모리블록 포인터, 액세스마스크, 플래그 
      - 프로세스 초기화 되면 운영체제는 프로세스를 위한 커널 오브젝트를 생성 
      
  - Section 3 
    - 프로세스 간 커널 오브젝트의 공유 
      - 오브젝트 핸들의 상속을 이용하는 방법 
        - 오브젝트 핸들의 상속은 오브젝트를 공유하고자 하는 프로세스들이 페어런트-차일드 관계를 가질때 상속이 가능
        - 윈도우는 오브젝트 핸들의 상속을 지원한다. 오브젝트 자체의 상속이 아니다.
        - 오브젝트 핸들 상속은 차이들 프로세스를 새로 생성할 때에만 적용이 가능하다.
        - 차일드 프로세스는 어떤 핸들이 상속된 것인지 알 수 없다.
    - 명명된 오브젝트를 사용하는 방법
      ```C++
      HANDLE CreateMutex(
        PSECURITY _ATTRIBUTES psa,
        BOOL bInitialOwner,
        PCTSTR pszNAME); 
       ```
       pszNAME 에 NULL 이 아닌 '\0' 끝나는 문자열[260] 전달하면 해당 이름의 커널 오브젝트를 생성 할 수 있다.
       
## 프로세스 (2023-02-13 ~ 2023-02-14)

